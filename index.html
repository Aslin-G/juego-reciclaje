<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clasifica & Gana: Reciclaje</title>
  <meta name="description" content="Juego educativo de clasificaci√≥n de residuos: org√°nico, reciclable y no aprovechable." />
  <style>
    :root{
      --bg:#ffffff;          /* fondo blanco */
      --text:#111827;        /* texto principal gris oscuro */
      --muted:#6b7280;       /* texto secundario */
      --card:#ffffff;        /* tarjetas claras */
      --border:#e5e7eb;      /* borde suave */
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
      --ok:#16a34a;          /* correcto */
      --bad:#ef4444;         /* incorrecto */
      --accent:#2563eb;      /* acento */
      --accent2:#22c55e;     /* acento secundario */
      --bin-org:#22c55e;
      --bin-rec:#38bdf8;
      --bin-noap:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    body{background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;padding:16px}
    .game{
      width:min(1000px,100%);
      background:#fff;
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .topbar{
      display:grid;
      grid-template-columns:1fr auto auto auto auto;
      gap:12px;
      align-items:center;
      padding:16px 18px;
      background:#fff;
      border-bottom:1px solid var(--border);
      position:sticky;top:0;z-index:5;
    }
    .title{font-weight:800;letter-spacing:.2px}
    .stat{background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:999px;font-size:14px}
    .wrap{padding:18px}
    .arena{display:grid;grid-template-columns:1fr;gap:18px}
    .itemCard{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:18px;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      min-height:200px;
      position:relative;
      text-align:center;
      box-shadow:var(--shadow);
      transition:transform .2s ease, background-color .2s ease;
      user-select:none;
    }
    .itemCard.dragging{opacity:.95;transform:scale(1.015)}
    .itemEmoji{font-size:68px;line-height:1.1;margin-bottom:8px}
    .itemName{font-size:24px;font-weight:800;margin-bottom:6px}
    .hint{font-size:14px;color:var(--muted)}
    .bins{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .bin{
      background:#fff;
      border:2px dashed var(--border);
      border-radius:16px;
      padding:16px;
      text-align:center;
      transition:transform .12s ease,border-color .12s ease,background .12s ease;
      min-height:130px;
      position:relative;
    }
    .binLabel{font-weight:800;margin-top:6px}
    .binEmoji{font-size:36px}
    .bin[data-cat="Org√°nico"]{--binColor:var(--bin-org)}
    .bin[data-cat="Reciclable"]{--binColor:var(--bin-rec)}
    .bin[data-cat="No aprovechable"]{--binColor:var(--bin-noap)}
    .bin.hover{transform:translateY(-2px);border-color:var(--binColor);background:var(--card)}
    .feedback{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      pointer-events:none;font-size:28px;font-weight:900;letter-spacing:.2px;
      opacity:0;transform:translateY(10px);transition:opacity .22s ease,transform .22s ease;
    }
    .feedback.show{opacity:1;transform:translateY(0)}
    .feedback.ok{color:var(--ok)}
    .feedback.bad{color:var(--bad)}
    .footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
    .btn{background:linear-gradient(180deg,var(--accent),#1e40af);border:none;color:white;
         font-weight:800;padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)}
    .btn.secondary{background:linear-gradient(180deg,var(--accent2),#15803d)}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal.show{display:flex}
    .modalCard{width:min(560px,100%);background:#fff;border:1px solid var(--border);
               border-radius:18px;box-shadow:var(--shadow);padding:20px;text-align:center;color:var(--text)}
    .stars{font-size:28px;margin:8px 0 2px}
    .explain{margin-top:10px;text-align:left;background:var(--card);border:1px solid var(--border);
             border-radius:14px;padding:12px;max-height:220px;overflow:auto}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
    .tag{font-size:12px;background:var(--card);border:1px solid var(--border);padding:4px 8px;border-radius:999px;color:#1e3a8a}
    @media (max-width:720px){
      .itemEmoji{font-size:56px}
      .itemName{font-size:20px}
      .bins{gap:10px}
    }
  </style>
</head>
<body>
  <div class="game" role="application" aria-label="Juego educativo de reciclaje">
    <div class="topbar">
      <div class="title">‚ôªÔ∏è Clasifica & Gana: Reciclaje</div>
      <div class="stat" id="level">Nivel: 1</div>
      <div class="stat" id="score">Puntos: 0</div>
      <div class="stat" id="lives">Vidas: 3</div>
      <div class="stat" id="time">Tiempo: 60s</div>
    </div>
    <div class="wrap">
      <div class="arena">
        <div id="itemCard" class="itemCard" draggable="true" aria-grabbed="false">
          <div class="itemEmoji" id="itemEmoji">üçå</div>
          <div class="itemName" id="itemName">C√°scara de pl√°tano</div>
          <div class="hint">Arrastra al contenedor correcto o toca un contenedor para clasificar.</div>
          <div class="feedback" id="feedback" aria-live="polite"></div>
        </div>
        <div class="bins" aria-label="Contenedores de reciclaje">
          <div class="bin" data-cat="Org√°nico" tabindex="0" aria-label="Contenedor Org√°nico">
            <div class="binEmoji">üåø</div>
            <div class="binLabel">Org√°nico</div>
          </div>
          <div class="bin" data-cat="Reciclable" tabindex="0" aria-label="Contenedor Reciclable">
            <div class="binEmoji">‚ôªÔ∏è</div>
            <div class="binLabel">Reciclable</div>
          </div>
          <div class="bin" data-cat="No aprovechable" tabindex="0" aria-label="Contenedor No aprovechable">
            <div class="binEmoji">üóëÔ∏è</div>
            <div class="binLabel">No aprovechable</div>
          </div>
        </div>
        <div class="footer">
          Consejo: puedes <b>hacer clic</b> en el contenedor si no quieres arrastrar. Cambia o a√±ade objetos en el arreglo <code>ITEMS</code> para personalizar. 
          <button class="btn secondary" id="btnSkip" title="Saltar √≠tem (pierdes 1 vida)">Saltar</button>
        </div>
      </div>
    </div>
  </div>
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Resultados">
    <div class="modalCard">
      <h2>üéâ ¬°Fin del juego!</h2>
      <div class="stars" id="stars">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</div>
      <p id="summary">Puntos: 0 ‚Äî Aciertos: 0 ‚Äî Errores: 0</p>
      <div class="row" style="margin:10px 0 12px">
        <span class="tag">Org√°nico = üåø</span>
        <span class="tag">Reciclable = ‚ôªÔ∏è</span>
        <span class="tag">No aprovechable = üóëÔ∏è</span>
      </div>
      <div class="explain" id="explainList"></div>
      <div style="margin-top:14px">
        <button class="btn" id="btnRestart">Jugar de nuevo</button>
      </div>
    </div>
  </div>
  <script>
    // =========================
    //   CONFIGURACI√ìN DEL JUEGO
    // =========================
    const GAME_TIME = 60;      // segundos por ronda
    const START_LIVES = 3;
    const POINTS_OK = 100;
    const POINTS_BAD = -50;
    const LEVEL_SIZE = 10;     // √≠tems aproximados por nivel
    const RECORDS_KEY = "records"; // almacenamiento de puntuaciones
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxzQ_7Y9Cn82dYOUsVaNyCuOOgyRQEu1hPmZjnebE_H6VmmOu9sNN-UslgcOBh1hsKXAg/exec";
    // √çtems del juego (editables)
    const ITEMS = [
      {name:"C√°scara de pl√°tano", emoji:"üçå", cat:"Org√°nico", tip:"Restos de frutas y verduras son compostables."},
      {name:"Hojas secas", emoji:"üçÇ", cat:"Org√°nico", tip:"Material ideal para compost."},
      {name:"Caf√© molido usado", emoji:"‚òïÔ∏è", cat:"Org√°nico", tip:"Aporta nitr√≥geno al compost."},
      {name:"Botella pl√°stica (PET)", emoji:"ü•§", cat:"Reciclable", tip:"Enjuaga y aplasta para reciclar."},
      {name:"Lata de aluminio", emoji:"ü•´", cat:"Reciclable", tip:"El aluminio es altamente reciclable."},
      {name:"Papel/Cart√≥n limpio", emoji:"üìÑ", cat:"Reciclable", tip:"Evita mezclarlo con comida o grasa."},
      {name:"Botella de vidrio", emoji:"üçæ", cat:"Reciclable", tip:"El vidrio se recicla infinitas veces."},
      {name:"Servilleta sucia", emoji:"üßª", cat:"No aprovechable", tip:"Contaminada: va a no aprovechable."},
      {name:"Paquete de snacks", emoji:"üçü", cat:"No aprovechable", tip:"Multicapa dif√≠cil de reciclar."},
      {name:"Colilla de cigarrillo", emoji:"üö¨", cat:"No aprovechable", tip:"Desecho contaminante, nunca al piso."},
      {name:"Pa√±al desechable", emoji:"üçº", cat:"No aprovechable", tip:"Residuos sanitarios ‚Üí no aprovechable."},
      {name:"C√°scara de huevo", emoji:"ü•ö", cat:"Org√°nico", tip:"Se puede compostar (mejor triturada)."},
      {name:"Revista", emoji:"üìö", cat:"Reciclable", tip:"Si est√° seca y limpia, se recicla."},
      {name:"Caja de cart√≥n", emoji:"üì¶", cat:"Reciclable", tip:"Dobla y mant√©n seca para reciclar."},
      {name:"Restos de comida", emoji:"üçΩÔ∏è", cat:"Org√°nico", tip:"Van al contenedor org√°nico/compost."}
    ];

    // =========================
    //   ESTADO
    // =========================
    let pool = [];         // bolsa de √≠tems para el nivel
    let current = null;    // √≠tem actual
    let score = 0;
    let lives = START_LIVES;
    let level = 1;
    let timeLeft = GAME_TIME;
    let timer = null;
    let stats = {ok:0,bad:0,explanations:[]};

    // =========================
    //   UTILIDADES
    // =========================
    const $ = sel => document.querySelector(sel);
    function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
    function pickPool(){
      const copy = shuffle([...ITEMS]);
      const size = Math.min(LEVEL_SIZE + (level-1)*4, ITEMS.length);
      return copy.slice(0,size);
    }
    function updateHUD(){
      $("#score").textContent = `Puntos: ${score}`;
      $("#lives").textContent = `Vidas: ${lives}`;
      $("#level").textContent = `Nivel: ${level}`;
      $("#time").textContent = `Tiempo: ${timeLeft}s`;
    }
    function nextItem(){
      if(pool.length===0){ // Siguiente nivel aumenta dificultad al usar m√°s √≠tems
        level++;
        pool = pickPool();
      }
      current = pool.pop();
      $("#itemEmoji").textContent = current.emoji;
      $("#itemName").textContent = current.name;
    }
    function feedback(ok, extra){
      const el = $("#feedback");
      el.className = "feedback " + (ok?"ok":"bad");
      el.textContent = ok ? "¬°Correcto!" : "Int√©ntalo de nuevo";
      el.classList.add("show");
      setTimeout(()=>el.classList.remove("show"), 800);
      if(extra){
        try{ if(navigator.vibrate){ navigator.vibrate(ok?[30]:[120,60,80]) } }catch(e){}
      }
    }
    function endGame(){
      clearInterval(timer);
      // estrellas
      const stars = score>=1200 ? "‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è" : score>=700 ? "‚≠êÔ∏è‚≠êÔ∏è" : "‚≠êÔ∏è";
      $("#stars").textContent = stars;
      $("#summary").textContent = `Puntos: ${score} ‚Äî Aciertos: ${stats.ok} ‚Äî Errores: ${stats.bad}`;
      // explicaciones (√∫ltimas 12)
      const box = $("#explainList");
      box.innerHTML = "";
      stats.explanations.slice(-12).forEach(txt=>{
        const p = document.createElement("p");
        p.style.margin="6px 0";
        p.textContent = "‚Ä¢ " + txt;
        box.appendChild(p);
      });
      $("#modal").classList.add("show");
      setTimeout(()=>{
        const nombreCompleto = prompt("Ingresa tu nombre completo:");
        if(nombreCompleto){
          const records = JSON.parse(localStorage.getItem(RECORDS_KEY) || "[]");
          records.push({ nombre: nombreCompleto, puntos: score });
          localStorage.setItem(RECORDS_KEY, JSON.stringify(records));
          fetch(WEB_APP_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              nombre: nombreCompleto,
              puntos: score,
              ok: stats.ok,
              bad: stats.bad,
              explicaciones: stats.explanations
            })
          }).catch(err=>console.error('Error enviando datos', err));
        }
      },100);
    }
    function startTimer(){
      clearInterval(timer);
      timeLeft = GAME_TIME;
      timer = setInterval(()=>{
        timeLeft--;
        $("#time").textContent = `Tiempo: ${timeLeft}s`;
        if(timeLeft<=0){ endGame(); }
      }, 1000);
    }
    function restart(){
      score=0; lives=START_LIVES; level=1; stats={ok:0,bad:0,explanations:[]};
      pool = pickPool();
      nextItem(); updateHUD(); startTimer();
      $("#modal").classList.remove("show");
    }

    // =========================
    //   CLASIFICACI√ìN
    // =========================
    function classify(targetCat){
      if(!current) return;
      const ok = current.cat === targetCat;
      if(ok){
        score += POINTS_OK; stats.ok++;
        stats.explanations.push(`${current.name} ‚Üí ${current.cat}. ${current.tip}`);
        feedback(true,true);
        // Siguiente √≠tem
        nextItem();
      }else{
        score = Math.max(0, score + POINTS_BAD);
        lives--;
        stats.bad++;
        feedback(false,true);
        shake($("#itemCard"));
        if(lives<=0){ endGame(); return; }
      }
      updateHUD();
    }
    function shake(el){
      el.animate([
        {transform:'translateX(0)'},
        {transform:'translateX(-10px)'},
        {transform:'translateX(10px)'},
        {transform:'translateX(0)'}
      ],{duration:200});
    }

    // =========================
    //   INTERACCI√ìN (drag/click/teclado)
    // =========================
    const itemCard = $("#itemCard");
    // Drag & Drop (escritorio)
    itemCard.addEventListener("dragstart", e=>{
      itemCard.classList.add("dragging");
      e.dataTransfer.setData("text/plain","ITEM");
    });
    itemCard.addEventListener("dragend", ()=>itemCard.classList.remove("dragging"));

    document.querySelectorAll(".bin").forEach(bin=>{
      bin.addEventListener("dragover", e=>{ e.preventDefault(); bin.classList.add("hover") });
      bin.addEventListener("dragleave", ()=>bin.classList.remove("hover"));
      bin.addEventListener("drop", e=>{
        e.preventDefault(); bin.classList.remove("hover");
        classify(bin.dataset.cat);
      });
      // Click/tap
      bin.addEventListener("click", ()=> classify(bin.dataset.cat));
      // Teclado (Enter/Espacio)
      bin.addEventListener("keydown", (e)=>{
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); classify(bin.dataset.cat); }
      });
    });

    // Botones
    document.getElementById("btnRestart").addEventListener("click", restart);
    document.getElementById("btnSkip").addEventListener("click", ()=>{
      lives--; updateHUD(); nextItem();
      if(lives<=0){ endGame(); }
    });

    // Pausa si la pesta√±a se oculta (no obligatorio, pero mejora UX)
    document.addEventListener("visibilitychange", ()=>{
      if(document.hidden){ clearInterval(timer); }
      else{ startTimer(); }
    });

    // Inicio
    (function init(){
      pool = pickPool(); nextItem(); updateHUD(); startTimer();
    })();
  </script>
</body>
</html>
