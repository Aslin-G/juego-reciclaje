<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clasifica & Gana: Reciclaje ‚Äî versi√≥n corregida</title>
<style>
  :root{
    --bg:#f6f8fa; --text:#1f2937; --muted:#6b7280; --card:#ffffff; --shadow:0 8px 30px rgba(0,0,0,.06);
    --org:#19a974; --rec:#ffffff; --noa:#111827; --pel:#e11d48;
    --ok:#10b981; --bad:#ef4444; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
       background:linear-gradient(180deg,#f9fafb, #eef2f7 60%, #e5ebf2)}
  .wrap{max-width:980px;margin:32px auto;padding:0 16px}
  .title{display:flex;align-items:center;gap:10px;color:#065f46;font-weight:800}
  .hud{display:flex;gap:12px;flex-wrap:wrap;margin:14px 0 22px}
  .pill{background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:8px 12px;box-shadow:var(--shadow);font-weight:600;color:#334155}
  .timerbar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:6px 0 0}
  .bar{height:100%;width:100%;background:#22c55e;transition:width .2s linear}
  .card{background:var(--card);box-shadow:var(--shadow);border-radius:20px;padding:22px}
  .arena{display:grid;gap:18px}
  .itembox{min-height:130px;border:2px dashed #d1d5db;border-radius:16px;display:flex;align-items:center;justify-content:center;color:var(--muted);text-align:center;background:#fbfbfd}
  .item{display:inline-flex;flex-direction:column;align-items:center;gap:8px;padding:16px 22px;border-radius:16px;background:#fff;border:1px solid #e5e7eb;cursor:grab;box-shadow:var(--shadow)}
  .emoji{font-size:40px;line-height:1}
  .name{font-size:20px;font-weight:800;color:#111827}
  .hint{font-size:13px;color:var(--muted)}
  .bins{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px;margin-top:8px}
  @media(min-width:800px){ .arena{grid-template-columns:1fr} .bins{grid-template-columns:repeat(4,1fr)}}
  .bin{border-radius:18px;padding:16px;display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;cursor:pointer;min-height:110px;border:2px solid #e5e7eb;transition:transform .06s ease}
  .bin:active{transform:scale(.98)}
  .bin h3{margin:2px 0 0;font-size:16px}
  .tag{font-size:12px;opacity:.8}
  .bin.org{background:linear-gradient(#e9fff4,#dbfbea);border-color:#b7f2cf}
  .bin.rec{background:linear-gradient(#ffffff,#f9fafb);border-color:#d1d5db}
  .bin.noa{background:linear-gradient(#1f2937,#111827);border-color:#111827;color:#f9fafb}
  .bin.pel{background:linear-gradient(#ffe4e6,#fecdd3);border-color:#fda4af}
  .bin .big{font-size:32px}
  .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
  button{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .ghost{background:#eef2f7;color:#374151}
  .primary{background:#0ea5e9;color:white}
  .success{background:#10b981;color:white}
  .danger{background:#ef4444;color:white}
  .toast{margin-top:14px;padding:12px 14px;border-radius:12px;background:#f9fafb;border:1px solid #e5e7eb;color:#334155}
  .toast.ok{border-color:#bbf7d0;background:#ecfdf5;color:#065f46}
  .toast.bad{border-color:#fecaca;background:#fef2f2;color:#7f1d1d}
  .end{padding:22px}
  .grid{display:grid;gap:8px}
  .mistakes{max-height:260px;overflow:auto;border:1px dashed #e5e7eb;border-radius:12px;padding:10px;background:#fff}
  .mistakes li{margin:6px 0}
  .legend{margin-top:20px;display:grid;gap:8px;grid-template-columns:repeat(4,1fr)}
  .legend .key{display:flex;gap:8px;align-items:center;font-size:12px}
  .dot{width:14px;height:14px;border-radius:50%}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";padding:2px 6px;border:1px solid #d1d5db;border-radius:6px;background:#fff;font-size:12px}
  .tests{font-size:12px;border:1px dashed #d1d5db;border-radius:10px;padding:10px;margin-top:8px;background:#fff}
  .tests details{margin:6px 0}
</style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <span style="font-size:26px">‚ôªÔ∏è</span>
    <h1 style="margin:0;font-size:22px">Clasifica & Gana: Reciclaje</h1>
  </div>

  <div class="hud">
    <div class="pill">‚è±Ô∏è Tiempo: <span id="time">60</span>s
      <div class="timerbar"><div class="bar" id="bar"></div></div>
    </div>
    <div class="pill">‚≠ê Puntos: <span id="score">0</span></div>
    <div class="pill">‚úÖ Aciertos: <span id="hits">0</span></div>
    <div class="pill">üî• Racha: <span id="streak">0</span></div>
  </div>

  <div class="arena card" id="game">
    <div class="itembox" id="dropzone">
      <div id="item" class="item" draggable="true" aria-grabbed="true">
        <div class="emoji" id="emoji">üó≥Ô∏è</div>
        <div class="name" id="name">Pulsa ‚ÄúIniciar‚Äù</div>
        <div class="hint">Arrastra al contenedor correcto o presiona <span class="kbd">1</span>‚Äì<span class="kbd">4</span></div>
      </div>
    </div>

    <div class="bins">
      <div class="bin org" data-cat="organico" tabindex="0" aria-label="Org√°nico (tecla 1)">
        <div class="big">üåø</div><h3>Org√°nico</h3><div class="tag">Verde</div>
      </div>
      <div class="bin rec" data-cat="reciclable" tabindex="0" aria-label="Reciclable (tecla 2)">
        <div class="big">‚ôªÔ∏è</div><h3>Reciclable</h3><div class="tag">Blanco</div>
      </div>
      <div class="bin noa" data-cat="no_aprovechable" tabindex="0" aria-label="No aprovechable (tecla 3)">
        <div class="big">üóëÔ∏è</div><h3>No aprovechable</h3><div class="tag">Negro</div>
      </div>
      <div class="bin pel" data-cat="peligroso" tabindex="0" aria-label="Peligroso (tecla 4)">
        <div class="big">‚ö†Ô∏è</div><h3>Peligroso / Posconsumo</h3><div class="tag">Rojo</div>
      </div>
    </div>

    <div class="actions">
      <button class="primary" id="startBtn">Iniciar (60 s)</button>
      <button class="ghost" id="skipBtn" title="Saltar este elemento (‚Äì2 pts)">Saltar</button>
      <button class="ghost" id="howBtn">¬øC√≥mo se clasifica?</button>
      <button class="success" id="restartBtn" style="display:none">Reiniciar</button>
      <button class="ghost" id="testBtn" title="Ejecuta pruebas autom√°ticas">Pruebas</button>
    </div>

    <div class="toast" id="toast">Consejo: limpia y seca lo reciclable; si est√° muy sucio, va a ‚ÄúNo aprovechable‚Äù.</div>

    <div class="tests" id="tests" style="display:none"></div>
  </div>

  <div class="legend">
    <div class="key"><span class="dot" style="background:var(--org)"></span>Org√°nico (verde)</div>
    <div class="key"><span class="dot" style="background:var(--rec);border:1px solid #d1d5db)"></span>Reciclable (blanco)</div>
    <div class="key"><span class="dot" style="background:var(--noa)"></span>No aprovechable (negro)</div>
    <div class="key"><span class="dot" style="background:var(--pel)"></span>Peligroso/posconsumo (rojo)</div>
  </div>
</div>

<script>
'use strict';
// Manejador global de errores (no m√°s ‚ÄúScript error‚Äù silencioso)
(function(){
  window.addEventListener('error', function(e){
    const box = document.getElementById('toast');
    if(box){
      box.className = 'toast bad';
      box.innerHTML = '‚ö†Ô∏è Ocurri√≥ un error en el juego: <b>'+ (e.message || 'Error') +'</b>' +
        (e.filename? ' ‚Äî '+e.filename:'') + (typeof e.lineno==='number'? ' ('+e.lineno+':'+e.colno+')':'' ) +
        '<br/>Recarga la p√°gina. Si persiste, abre la consola y comparte el mensaje.';
    }
  });
})();

document.addEventListener('DOMContentLoaded', function(){
  // ===== Datos de juego: 80+ √≠tems =====
  const ITEMS = [
    // ORG√ÅNICOS
    ["C√°scara de pl√°tano","organico","üçå","Se compostea; aporta potasio al abono."],
    ["Restos de arroz","organico","üçö","Org√°nico aprovechable: compost o lombricultura."],
    ["Restos de verduras","organico","ü•ó","Org√°nico; ideal para compost casero."],
    ["Posos de caf√©","organico","‚òï","Excelente para compost; aporta nitr√≥geno."],
    ["Bolsita de t√©","organico","ü´ñ","Org√°nica si NO tiene grapas/estaples."],
    ["C√°scaras de huevo","organico","ü•ö","Org√°nico; trit√∫ralas antes de compostar."],
    ["Hojas secas","organico","üçÇ","Materia ‚Äòmarr√≥n‚Äô para balancear el compost."],
    ["Podas de jard√≠n","organico","üåø","Org√°nico; pica ramas para acelerar."],
    ["Pan duro","organico","üçû","Org√°nico; mejor troceado para compost."],
    ["C√°scara de naranja","organico","üçä","Org√°nico; en poca cantidad por acidez."],
    ["C√°scara de papa","organico","ü•î","Org√°nico; evita grandes cantidades crudas."],
    ["Restos de frutas","organico","üçâ","Org√°nico; no mezclar con bolsas."],
    ["Huesos de pollo","organico","üçó","Org√°nico; tardan m√°s en descomponerse."],
    ["Restos de pescado","organico","üêü","Org√°nico; c√∫brelos en el compost para evitar olores."],
    ["C√°scara de man√≠","organico","ü•ú","Org√°nica; dura pero compostable."],
    ["Bagazo de ca√±a","organico","üßâ","Fibra org√°nica para compost."],
    ["Aserr√≠n limpio","organico","ü™µ","Solo si es madera natural (sin barnices)."],
    ["Sobras de comida cocida","organico","üçΩÔ∏è","Org√°nico; mejor en compostaje caliente."],
    ["C√°scara de coco","organico","ü••","Org√°nica; trocea para acelerar."],

    // RECICLABLES (limpios y secos)
    ["Botella PET transparente","reciclable","ü•§","Enjuaga y aplasta; tapa aparte."],
    ["Botella PET de color","reciclable","üß¥","Clasif√≠cala con otras PET; limpia y seca."],
    ["Tapa pl√°stica","reciclable","üîµ","Reciclable; junta varias tapas para donaci√≥n."],
    ["Bolsa pl√°stica limpia","reciclable","üõçÔ∏è","Reciclable si est√° limpia y seca."],
    ["Lata de aluminio","reciclable","ü•´","Apl√°stala limpia; es de alto valor."],
    ["Lata de acero","reciclable","ü•´","Reciclable; limpia para evitar malos olores."],
    ["Envase de vidrio transparente","reciclable","üçæ","Retira tapas; no mezcles con cer√°mica."],
    ["Frasco de vidrio √°mbar","reciclable","üß™","Vidrio reciclable; limpio y sin tapa."],
    ["Papel bond limpio","reciclable","üìÑ","No engrapado/engomado en exceso."],
    ["Cart√≥n corrugado","reciclable","üì¶","Mant√©nlo seco; pliega las cajas."],
    ["Peri√≥dico limpio","reciclable","üóûÔ∏è","√ötil para reciclaje de papel."],
    ["Revista","reciclable","üìö","Reciclable; evita plastificados con comida."],
    ["Cart√≥n para bebidas (Tetra Pak) limpio","reciclable","üßÉ","Enjuaga y aplasta; s√≠ se recicla en muchas ciudades."],
    ["Lata de at√∫n limpia","reciclable","ü•´","L√°valas para evitar contaminaci√≥n."],
    ["Botella de champ√∫ HDPE enjuagada","reciclable","üß¥","Pl√°stico #2: alta reciclabilidad."],
    ["Gal√≥n de detergente enjuagado","reciclable","üßº","Pl√°stico #2/#5; reciclar limpio y seco."],
    ["Papel aluminio limpio","reciclable","üßª","Si est√° limpio y hecho bola, se recicla."],
    ["Bandeja de PP (No.5) limpia","reciclable","üç±","Si est√° limpia, puede reciclarse."],
    ["Tapas met√°licas","reciclable","üß≤","J√∫ntalas; son ferrosas y reciclables."],
    ["Tubos de cart√≥n (higi√©nico) limpios","reciclable","üßª","Reciclable si no est√° sucio."],
    ["Caja de huevos de cart√≥n limpia","reciclable","ü•ö","Reciclable o compostable si no est√° sucia."],
    ["Botella de vidrio verde","reciclable","üçæ","Separa por colores si es posible."],
    ["Botella de aceite vac√≠a y enjuagada (PET)","reciclable","üõ¢Ô∏è","Vac√≠a bien; no mezcles con aceite usado."],
    ["Folder de cartulina limpio","reciclable","üìÅ","Papel/cart√≥n reciclable."],

    // NO APROVECHABLES
    ["Pa√±al desechable","no_aprovechable","üçº","Residuo sanitario: bolsa negra."],
    ["Papel higi√©nico usado","no_aprovechable","üöΩ","Sanitario: NO va con reciclables."],
    ["Toalla higi√©nica","no_aprovechable","ü©∏","Sanitario: disponer en negro."],
    ["Servilleta muy sucia con grasa","no_aprovechable","ü•Ø","Si est√° muy sucia, ya no se recicla."],
    ["Papel metalizado de snacks","no_aprovechable","üç¨","Multicapa metalizada: no reciclable dom√©stico."],
    ["Vaso de icopor (EPS) sucio","no_aprovechable","ü•§","Si est√° sucio, va a negro; limpio depende de tu ciudad."],
    ["Pl√°stico film con restos de comida","no_aprovechable","üßÜ","Contaminado: negro."],
    ["Cepillo de dientes viejo","no_aprovechable","ü™•","No reciclable municipal; c√°mbialo por bamb√∫."],
    ["Cer√°mica rota","no_aprovechable","üß±","No es vidrio; no se recicla en envases."],
    ["Espejo roto","no_aprovechable","ü™û","No es vidrio de envase; envu√©lvelo para evitar cortes."],
    ["Colilla de cigarrillo","no_aprovechable","üö¨","T√≥xica; nunca al piso ni al WC."],
    ["Chicle","no_aprovechable","üç¨","Residuos peque√±os: negro."],
    ["Esponja de cocina usada","no_aprovechable","üßΩ","Se desgasta y contamina: negro."],
    ["Plato de loza roto","no_aprovechable","üçΩÔ∏è","No reciclable; negro."],
    ["Envase de yogur muy sucio","no_aprovechable","ü•õ","Si no puedes lavarlo, basura negra."],
    ["Papel carb√≥n","no_aprovechable","üìú","No reciclable por su tratamiento."],
    ["Lapicero gastado","no_aprovechable","üñäÔ∏è","Mezcla de materiales: negro."],
    ["Polvo de aspiradora / pelusas","no_aprovechable","üßπ","Negro; no reciclable."],

    // PELIGROSOS / POSCONSUMO
    ["Pila AA / AAA","peligroso","üîã","Ll√©vala a puntos de posconsumo (rojo)."],
    ["Bater√≠a de celular","peligroso","üì±","Altamente contaminante; posconsumo."],
    ["Bombillo fluorescente","peligroso","üí°","Contiene mercurio; manejo especial."],
    ["Aceite de cocina usado","peligroso","üõ¢Ô∏è","Nunca al lavaplatos; almacena y entrega."],
    ["Medicamentos vencidos","peligroso","üíä","Ll√©valos a puntos de recolecci√≥n."],
    ["Jeringa/aguja","peligroso","üíâ","Cortopunzante; contenedor rojo r√≠gido."],
    ["Term√≥metro de mercurio","peligroso","üå°Ô∏è","Peligroso por mercurio; no romper."],
    ["Pinturas y solventes","peligroso","üé®","Inflamables/t√≥xicos; punto especial."],
    ["Insecticida","peligroso","ü™∞","Qu√≠mico: posconsumo."],
    ["Aerosol con contenido","peligroso","üß¥","Presurizado y peligroso; rojo."],
    ["T√≥ner de impresora","peligroso","üñ®Ô∏è","Recolecta en puntos posconsumo."],
    ["Pila bot√≥n","peligroso","üîò","Muy contaminante; rojo."],
    ["Pegante industrial","peligroso","üß∑","Solventes; no al reciclaje."],
    ["Thinner / disolvente","peligroso","üß™","Punto especializado."],
    ["Bater√≠a de autom√≥vil","peligroso","üöó","Plomo/√°cido: gestor autorizado."],
    ["Cosm√©tico con qu√≠micos (residuo)","peligroso","üíÑ","Si contiene qu√≠micos, manejo especial."]
  ];

  // Utilidades y l√≥gica pura (testeable)
  const $ = s => document.querySelector(s);
  const byId = id => document.getElementById(id);
  const rand = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  const shuffle = arr => arr.sort(()=>Math.random()-0.5);
  const GameLogic = {
    scoreFor(correct, currentStreak){
      if(!correct) return {delta:-5, newStreak:0};
      const bonus = Math.min(20, currentStreak*2);
      return {delta:10 + bonus, newStreak:currentStreak+1};
    },
    isValidCat(c){ return ['organico','reciclable','no_aprovechable','peligroso'].includes(c); }
  };

  // Estado
  let pool=[], idx=0, score=0, hits=0, streak=0, timer=null, timeLeft=60, finished=false;
  let mistakes=[];

  // UI
  const nameEl = byId('name'), emojiEl = byId('emoji'), toast = byId('toast');
  const scoreEl = byId('score'), hitsEl=byId('hits'), streakEl=byId('streak');
  const timeEl = byId('time'), barEl=byId('bar');
  const startBtn = byId('startBtn'), restartBtn=byId('restartBtn'), skipBtn=byId('skipBtn'), howBtn=byId('howBtn');
  const itemEl = byId('item');
  const testsBox = byId('tests'); const testBtn = byId('testBtn');

  // Contenedores
  document.querySelectorAll('.bin').forEach(bin=>{
    bin.addEventListener('click', ()=> choose(bin.dataset.cat));
    bin.addEventListener('dragover', e=>{e.preventDefault(); bin.style.outline='3px dashed #38bdf8'});
    bin.addEventListener('dragleave', ()=> bin.style.outline='none');
    bin.addEventListener('drop', e=>{ e.preventDefault(); bin.style.outline='none'; choose(bin.dataset.cat);});
  });

  // Teclado 1‚Äì4
  window.addEventListener('keydown', e=>{
    if(finished) return;
    const map = { '1':'organico', '2':'reciclable', '3':'no_aprovechable', '4':'peligroso' };
    if(map[e.key]) choose(map[e.key]);
  });

  itemEl.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain','item'); });

  startBtn.onclick = start;
  restartBtn.onclick = start;
  skipBtn.onclick = ()=>{ if(finished) return; score=Math.max(0,score-2); next('‚è≠Ô∏è Salto: ‚Äì2 pts'); };
  howBtn.onclick = ()=> showTipForCurrent();
  testBtn.onclick = runTests;

  function start(){
    try{
      finished=false; mistakes=[];
      score=hits=streak=0; idx=0; timeLeft=60;
      scoreEl.textContent='0'; hitsEl.textContent='0'; streakEl.textContent='0';
      timeEl.textContent=String(timeLeft); barEl.style.width='100%';
      startBtn.style.display='none'; restartBtn.style.display='inline-block';
      testsBox.style.display='none'; testsBox.innerHTML='';
      pool = shuffle([...ITEMS]).slice(0, Math.max(50, Math.min(ITEMS.length, 80)));
      if(!pool.length) throw new Error('No hay √≠tems para jugar');
      show(pool[idx]);
      if(timer) clearInterval(timer);
      timer = setInterval(()=>{ if(--timeLeft<=0){ timeLeft=0; end(); } updateTimeBar(); }, 1000);
      toast.className = 'toast';
      toast.textContent = 'Arrastra o usa 1‚Äì4 para clasificar m√°s r√°pido. ¬°Limpio y seco = reciclable!';
    }catch(err){ reportError(err); }
  }

  function show([name, cat, emoji, tip]){
    if(!name || !GameLogic.isValidCat(cat)) throw new Error('√çtem inv√°lido');
    nameEl.textContent = name;
    emojiEl.textContent = emoji || 'üì¶';
    itemEl.dataset.cat = cat;
    itemEl.dataset.tip = tip || '';
  }

  function choose(cat){
    if(finished) return;
    const real = itemEl.dataset.cat; const tip = itemEl.dataset.tip;
    const correct = (cat===real);
    const {delta,newStreak} = GameLogic.scoreFor(correct, streak);
    score = Math.max(0, score + delta);
    streak = newStreak; if(correct) hits++;

    if(correct){
      toast.className='toast ok';
      toast.innerHTML = `‚úÖ ¬°Correcto! <b>${nameEl.textContent}</b> ‚Üí <b>${pretty(real)}</b>. ${tip}`;
    }else{
      mistakes.push({item:nameEl.textContent, correcto:pretty(real), elegido:pretty(cat), tip});
      toast.className='toast bad';
      toast.innerHTML = `‚ùå Ups. <b>${nameEl.textContent}</b> va a <b>${pretty(real)}</b>. ${tip}`;
    }
    scoreEl.textContent = String(score); hitsEl.textContent = String(hits); streakEl.textContent = String(streak);
    next();
  }

  function next(extraMsg){
    idx++;
    if(idx>=pool.length){ end(); return; }
    show(pool[idx]);
    if(extraMsg){ toast.className='toast'; toast.textContent = extraMsg; }
  }

  function updateTimeBar(){
    timeEl.textContent = String(timeLeft);
    const pct = (timeLeft/60)*100;
    barEl.style.width = pct + '%';
    barEl.style.background = timeLeft<10 ? '#ef4444' : (timeLeft<20 ? '#f59e0b' : '#22c55e');
  }

  function showTipForCurrent(){
    toast.className='toast';
    const fallback = 'Clasifica pensando en: <i>limpio y seco = reciclable</i>; <i>muy sucio = no aprovechable</i>; <i>qu√≠micos/afilados = peligroso</i>.';
    toast.innerHTML = `‚ÑπÔ∏è ${nameEl.textContent}: ${itemEl.dataset.tip || fallback}`;
  }

  function end(){
    if(finished) return; finished=true; if(timer) clearInterval(timer); barEl.style.width='0%';
    const total = idx; const acc = total? Math.round((hits/total)*100):0;
    const eco = ecoMission(); const game = byId('game');
    game.innerHTML = `
      <div class="end card">
        <h2>‚è∞ ¬°Tiempo! Resultado final</h2>
        <div class="hud" style="margin:10px 0 6px">
          <div class="pill">‚≠ê Puntos: <b>${score}</b></div>
          <div class="pill">‚úÖ Aciertos: <b>${hits}/${total}</b></div>
          <div class="pill">üéØ Exactitud: <b>${acc}%</b></div>
        </div>
        <div class="grid">
          <div class="toast">üí° <b>Eco-tip:</b> Limpia, seca y aplasta los envases; el aceite usado va en botella cerrada y a punto de recolecci√≥n.</div>
          <div class="toast">ü§ù <b>Competencia ciudadana:</b> Separar bien reduce costos, dignifica el trabajo de recicladores y disminuye metano en rellenos.</div>
          <div class="toast">üå± <b>Misi√≥n del d√≠a:</b> ${eco}</div>
          ${ mistakes.length ? `
          <div class="toast">
            <b>Repasa tus errores (${mistakes.length}):</b>
            <ul class="mistakes">
              ${mistakes.map(m=>`<li>‚Ä¢ <b>${m.item}</b>: correcto <b>${m.correcto}</b> (t√∫ pusiste <i>${m.elegido}</i>). <span style="color:#6b7280">${m.tip}</span></li>`).join('')}
            </ul>
          </div>` : `<div class="toast ok">üèÜ ¬°Sin errores! ¬°Excelente clasificaci√≥n!</div>`}
          <div class="actions"><button class="success" onclick="location.reload()">Jugar de nuevo</button></div>
          <div class="toast" style="font-size:13px">
            <b>Gu√≠a r√°pida de colores (Colombia):</b> Verde = org√°nico; Blanco = reciclables limpios y secos; Negro = no aprovechables; Rojo = peligrosos/posconsumo.
          </div>
        </div>
      </div>`;
  }

  function ecoMission(){
    const ideas = [
      'Lleva hoy tus pilas usadas al punto rojo m√°s cercano.',
      'Di no a la bolsa: usa una reutilizable en tu pr√≥xima compra.',
      'Enjuaga y aplasta 5 botellas PET antes de sacarlas al reciclaje.',
      'Separa tus residuos org√°nicos para iniciar una compostera casera.',
      'Guarda el aceite usado en una botella y entr√©galo cuando est√© llena.',
      'Identifica en tu barrio qui√©n recoge reciclaje y acuerda un horario.',
      'Repara en lugar de botar: intenta arreglar ese electrodom√©stico.',
      'Cambia el cepillo de dientes por uno de bamb√∫ la pr√≥xima vez.',
      'Reduce latas y pl√°sticos de un solo uso durante una semana.',
      'En casa: instala un peque√±o contenedor rojo para peligrosos.'
    ];
    return ideas[rand(0,ideas.length-1)];
  }

  function pretty(cat){
    return ({organico:'Org√°nico',reciclable:'Reciclable',no_aprovechable:'No aprovechable',peligroso:'Peligroso/posconsumo'})[cat]||cat;
  }
  function reportError(err){
    console.error(err);
    const box = byId('toast');
    if(box){ box.className='toast bad'; box.textContent = 'Error: '+(err && err.message ? err.message : String(err)); }
  }

  // ===== Pruebas autom√°ticas =====
  function runTests(){
    const results = [];
    const assert = (name, cond) => { results.push({name, pass:!!cond}); };

    // 1) Banco v√°lido
    assert('‚â• 50 √≠tems en banco', ITEMS.length >= 50);
    assert('Todas las categor√≠as v√°lidas', ITEMS.every(x=>GameLogic.isValidCat(x[1])));

    // 2) Puntuaci√≥n (3 aciertos, 1 error)
    let s=0, st=0;
    let r = GameLogic.scoreFor(true, st); s+=r.delta; st=r.newStreak; // +10
    r = GameLogic.scoreFor(true, st); s+=r.delta; st=r.newStreak;     // +12
    r = GameLogic.scoreFor(true, st); s+=r.delta; st=r.newStreak;     // +14
    r = GameLogic.scoreFor(false, st); s=Math.max(0,s+r.delta); st=r.newStreak; // -5
    assert('Puntuaci√≥n simulada = 31', s === 31);
    assert('Racha tras error = 0', st === 0);

    // 3) Timer
    let tl = 60; tl--; assert('Timer decrementa 1s', tl === 59);

    // 4) √çtem ejemplo
    const ex = ITEMS.find(x=>x[0]==='C√°scara de pl√°tano');
    assert('√çtem ejemplo existe', !!ex);
    assert('√çtem ejemplo categor√≠a org√°nico', ex && ex[1]==='organico');

    // Render
    testsBox.style.display='block';
    testsBox.innerHTML = '<details open><summary><b>Resultados de pruebas ('+results.filter(r=>r.pass).length+'/'+results.length+' pasadas)</b></summary>'+
      '<ul>'+results.map(r=>'<li>'+(r.pass?'‚úÖ':'‚ùå')+' '+r.name+'</li>').join('')+'</ul></details>'+
      '<div style="font-size:12px;color:#6b7280">Nota: Las pruebas no cubren UI; validan reglas clave y datos.</div>';
  }

  // Auto-pruebas si #test en la URL
  if(location.hash==='#test'){ runTests(); }
});
</script>
</body>
</html>
